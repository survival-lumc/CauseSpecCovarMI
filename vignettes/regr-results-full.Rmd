---
title: "Regression coefficients: full results"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Regression coefficients: full results}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svg",
  fig.retina = 2, # change to 3 
  fig.align = "center",
  fig.width = 7,
  fig.height = 4,
  dev.args = list(bg = "transparent"),
  fig.ext = "svg"
)
```

```{r setup}
library(SimsCauseSpecCovarMiss)
#devtools::load_all()
library(ggplot2)
library(ggpubr)

theme_set(
  theme_bw(base_size = 11)
)

set.seed(1984)
```

# General set-up


```{r read}
# Read-in summarised results and scenarios
regr_results <- fst::read_fst("data/sims_regr_summary.fst") %>% data.table::setDT()
scenarios <- readRDS("data/scenarios.rds")
```

# Scenarios

```{r scenarios}
scenarios[, !"seed"] %>% knitr::kable()
```

# NLPs


```{r nlps, echo=FALSE, fig.height=6}
dat_nlp <- regr_results[
  m %in% c(0, 50) & 
    n == 2000 &
    var == "X.1" &
    beta1 != "0" &
    miss_mech == "MAR" & 
    X_level == "continuous" &
    !(analy %in% c("ref", "ch1")) 
]

p <- ggplot_nlp(
  dat = dat_nlp,
  estim = "bias", 
  method_var = "analy", 
  true = 0, 
  step_factors = c("beta1", "prop_miss", "haz_shape", "eta1"),
  point_dodge = 0.7,
  text_size = 4, 
  pointsize = 1.5, 
  height_steps = 0.01,
  height_betw_steps = 0.015,
  top_step = -0.15,
  step_labels = c(
    "beta1" = "Beta1 = {0.5, 1}",
    "prop_miss" = "Missing % = {10, 50}", 
    "haz_shape" = "Hazard shapes = {similar, different}",
    "eta1" = "Mech. strength = {weak, strong}"
  )
  ) +
  ggplot2::guides(shape = guide_legend("Method"),
                  linetype = guide_legend("Method")) +
  ylab("Bias") +
  theme_minimal(base_size = 14) +
  scale_y_continuous(breaks = c(0, -0.05, -0.1, - 0.15)) +
  theme(legend.position = "bottom")

p
```